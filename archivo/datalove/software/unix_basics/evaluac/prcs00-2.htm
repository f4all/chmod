<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.06 [es] (Win95; I) [Netscape]">
   <META NAME="AUTHOR" CONTENT="Victor Gonzalez-Barbone">
   <META NAME="CREATED" CONTENT="20000724;9342600">
   <META NAME="CHANGEDBY" CONTENT="Víctor González Barbone">
   <META NAME="CHANGED" CONTENT="20000724;14423100">
<STYLE>
	<!--
		@page { margin-left: 2.4cm; margin-right: 2.4cm; margin-top: 2cm; margin-bottom: 1cm }
	-->
	</STYLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">

<ADDRESS>
Centro de Inform&aacute;tica. Sistemas Operativos II. Curso 2000.</ADDRESS>

<BR>
<HR>
<CENTER>
<H2>
Prueba parcial 2/2.</H2></CENTER>

<CENTER>
<H3>
<FONT SIZE=+1>Soluci&oacute;n de Scripts</FONT></H3></CENTER>

<H4>
<B>Con libre consulta de material.</B></H4>

<DIV STYLE="margin-bottom: 0cm"><FONT SIZE=+2>1.</FONT> Escribir un script
que revise cada 5 minutos el correo del usuario que lo invoca, e informe
si ha recibido nuevo correo. El nuevo correo se guarda en el archivo /var/spool/mail/<I>usuario.</I>
Este archivo tiene longitud mayor que 0 cuando se ha recibido nuevo correo;
la longitud queda en 0 despu&eacute;s que el usuario lee su correo. Este
script correr&aacute; en forma permanente. &iquest;C&oacute;mo debe invocarse
para poder seguir trabajando normalmente ? (15 puntos).</DIV>

<P><BR><FONT FACE="courier, monospace">#!/bin/bash</FONT>
<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># ejer1:
revisa si hay correo cada 5 minutos</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">#</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># Debe
ejecutarse en "background".</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">USUARIO=$LOGNAME
# cambia nombre de la variable, por comodidad</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># repite
siempre</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">while true</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">do</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
if [ -s /var/spool/mail/$USUARIO ]</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
then</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;&nbsp;&nbsp;
# archivo de correo del usuario tiene largo > 0</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><TT><FONT FACE="courier, monospace">&nbsp;&nbsp;&nbsp;
echo "Tiene correo"</FONT></TT></DIV>

<DIV STYLE="margin-bottom: 0cm"><TT><FONT FACE="courier, monospace">&nbsp;
fi</FONT></TT></DIV>

<DIV STYLE="margin-bottom: 0cm"><TT><FONT FACE="courier, monospace">&nbsp;
# duerme 5 minutos (300 segundos)</FONT></TT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"><TT>&nbsp;
sleep
</TT>300</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><TT><FONT FACE="courier, monospace">done</FONT></TT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT SIZE=+2>2.</FONT> Escribir un script
para listar todos los usuarios correspondientes a un &aacute;rea de inter&eacute;s.
Se dispone de un archivo de datos de la forma</DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
# datos para el ejercicio 2</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
# nombre:c&eacute;dula:areas de inter&eacute;s:direcci&oacute;n electr&oacute;nica</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
#</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
Juan P&eacute;rez:1111111-1:DiGraf,WinNT:juan@cdi.edu.uy</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
Mar&iacute;a Garc&iacute;a:2222222-2:UNIX,Digraf,WinNT:pedro@cdi.edu.uy</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
Jos&eacute; Rodr&iacute;guez:3333333-3:StarOffice,WinNT,UNIX:jose@cdi.edu.uy</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm">El script recibe como par&aacute;metro
el nombre de un &aacute;rea de inter&eacute;s (DiGraf, WinNT, etc.), y
lista nombre y direcci&oacute;n electr&oacute;nica de las personas que
tienen esta &aacute;rea de inter&eacute;s en su lista. Si no hay ninguna
persona, o no existe el &aacute;rea, emite un mensaje informativo. <B>Advertencia:</B>
los nombres y apellidos de las personas est&aacute;n separados por espacio
en blanco. (15 puntos)</DIV>

<DIV STYLE="margin-bottom: 0cm">&nbsp;</DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">#!/bin/bash</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># ejer2:
muestra nombres y direcciones electr&oacute;nicas de una lista</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># seg&uacute;n
un &aacute;rea de inter&eacute;s que recibe como par&aacute;metro</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">#</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">clear</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">AREA=$1</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">LISTA=`cat
ejer2.dat | tr " " "_" | grep "[^:]*:[^:]*:[^:]*$AREA"`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">echo Area
de inter&eacute;s: $AREA</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">if [ !
"$LISTA" ]</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">then</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
echo " No hay interesados o no existe el &aacute;rea."</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">fi</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">for LINEA
in $LISTA</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">do</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
LINEA=`echo $LINEA | tr "_" " "`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
NOMBRE=`echo $LINEA | cut -d: -f1`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
DIRELEC=`echo $LINEA | cut -d: -f4`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
echo " $NOMBRE - $DIRELEC"</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">done</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT SIZE=+2>3.</FONT> Se desea sumar
el espacio ocupado por un usuario en un directorio y todos sus subdirectorio.
Para ello, deben sumarse los tama&ntilde;os de todos los archivos de ese
usuario en esa rama de directorios. El script recibir&aacute; como par&aacute;metros
el nombre del usuario y el nombre del directorio. Validar&aacute; que el
usuario pertenezca al sistema, y que el nombre de directorio recibido sea
efectivamente un directorio. Presentar&aacute; el resultado total en bytes,
Kbytes y Mbytes enteros. <B>Sugerencia:</B> usar el comando <TT>find</TT>
con listado largo; el tama&ntilde;o de archivo en el listado largo est&aacute;
entre las columnas 47 y 56. (20 puntos)</DIV>

<DIV STYLE="margin-bottom: 0cm">&nbsp;</DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">#!/bin/bash</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># ejer3:
suma tama&ntilde;os archivo de un usuario</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># recibe
como par&aacute;metro un directorio</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">clear</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">USUARIO=$1</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">DIR=$2</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># valida
existencia de usuario</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">id $USUARIO
1>/dev/null 2>&amp;1</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">if [ $?
-ne 0 ]</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">then</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
echo "$USUARIO no es usuario del sistema"</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
exit 1</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">fi</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># valida
existencia de directorio</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">if [ !
-d $DIR ]</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">then</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
echo "$DIR no es un directorio"</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
exit 2</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">fi</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># obtiene
lista de tama&ntilde;os de archivos del usuario</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">LISTA=`find
$DIR -user $USUARIO -ls | cut -c43-53 | tr -d " "`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">ESPACIO=0</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace"># suma
largos de archivo</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">for LARGO
in $LISTA</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">do</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">&nbsp;
ESPACIO=`expr $ESPACIO + $LARGO`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">done</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">echo "El
espacio usado por el usuario $USUARIO en $DIR es "</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">echo "
$ESPACIO bytes"</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">ESPACIO=`expr
$ESPACIO \/ 1024`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">echo "
$ESPACIO Kbytes"</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">ESPACIO=`expr
$ESPACIO \/ 1024`</FONT></DIV>

<DIV STYLE="margin-bottom: 0cm"><FONT FACE="courier, monospace">echo "
$ESPACIO Mbytes"</FONT></DIV>

</BODY>
</HTML>
